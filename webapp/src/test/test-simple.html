<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple WindBurglr Tests</title>
    <style>
        body { font-family: monospace; padding: 20px; background: #f5f5f5; }
        .test-container { background: white; padding: 20px; border-radius: 8px; max-width: 800px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 4px; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .btn { background: #667eea; color: white; border: none; padding: 10px 15px; margin: 5px; cursor: pointer; border-radius: 4px; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 4px; overflow-x: auto; }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>üß™ Simple WindBurglr Tests</h1>
        <p><strong>No CORS issues!</strong> This file tests basic functionality without ES modules.</p>
        
        <div class="test-section">
            <h3>üß≠ Navigation Test</h3>
            <div id="nav-test-results"></div>
            <button class="btn" onclick="testNavigation()">Test Navigation Functions</button>
            <pre id="nav-mock-output"></pre>
        </div>
        
        <div class="test-section">
            <h3>üè™ Store Pattern Test</h3>
            <div id="store-test-results"></div>
            <button class="btn" onclick="testStore()">Test Store Pattern</button>
            <pre id="store-output"></pre>
        </div>
        
        <div class="test-section">
            <h3>üåê Global Functions Test</h3>
            <div id="global-test-results"></div>
            <button class="btn" onclick="testGlobals()">Test Global Availability</button>
            <p><em>Note: This will only work if you load this file through a server with the main app running.</em></p>
        </div>
    </div>

    <script>
        function addResult(containerId, message, isSuccess = true) {
            const container = document.getElementById(containerId);
            const div = document.createElement('div');
            div.className = isSuccess ? 'success' : 'error';
            div.style.padding = '8px';
            div.style.margin = '4px 0';
            div.style.borderRadius = '4px';
            div.textContent = message;
            container.appendChild(div);
        }
        
        function testNavigation() {
            const results = document.getElementById('nav-test-results');
            const output = document.getElementById('nav-mock-output');
            results.innerHTML = '';
            output.innerHTML = '';
            
            // Mock the navigation function behavior
            const mockNavigateToDate = (date, station = 'TEST') => {
                const currentParams = new URLSearchParams('');
                const stn = currentParams.get('stn') || station;
                const url = `/day/${date}?stn=${stn}`;
                output.innerHTML += `Would navigate to: ${url}\\n`;
                return url;
            };
            
            try {
                // Test date navigation logic
                const result1 = mockNavigateToDate('2023-12-25');
                addResult('nav-test-results', '‚úì Date navigation logic works', true);
                
                const result2 = mockNavigateToDate('2024-01-01', 'STATION_ABC');
                addResult('nav-test-results', '‚úì Station parameter handling works', true);
                
                // Test date manipulation
                const yesterday = new Date();
                yesterday.setDate(yesterday.getDate() - 1);
                const year = yesterday.getFullYear();
                const month = String(yesterday.getMonth() + 1).padStart(2, '0');
                const day = String(yesterday.getDate()).padStart(2, '0');
                const yesterdayStr = `${year}-${month}-${day}`;
                
                addResult('nav-test-results', `‚úì Yesterday date calculation: ${yesterdayStr}`, true);
                
            } catch (error) {
                addResult('nav-test-results', `‚ùå Navigation test failed: ${error.message}`, false);
            }
        }
        
        function testStore() {
            const results = document.getElementById('store-test-results');
            const output = document.getElementById('store-output');
            results.innerHTML = '';
            output.innerHTML = '';
            
            try {
                // Mock simple store pattern
                class MockStore {
                    constructor() {
                        this.state = { windData: [], timeWindow: 3, connectionStatus: 'disconnected' };
                        this.listeners = [];
                    }
                    
                    subscribe(listener) {
                        this.listeners.push(listener);
                        return () => this.listeners.splice(this.listeners.indexOf(listener), 1);
                    }
                    
                    setState(updates) {
                        const prevState = { ...this.state };
                        this.state = { ...this.state, ...updates };
                        this.listeners.forEach(l => l(this.state, prevState));
                    }
                    
                    getState() { return { ...this.state }; }
                }
                
                const store = new MockStore();
                addResult('store-test-results', '‚úì Store creation works', true);
                
                let listenerCalled = false;
                const unsubscribe = store.subscribe(() => { listenerCalled = true; });
                addResult('store-test-results', '‚úì Store subscription works', true);
                
                store.setState({ windData: [[1640995200, 270, 15, 18]] });
                addResult('store-test-results', `‚úì Store state update works (listener called: ${listenerCalled})`, listenerCalled);
                
                const state = store.getState();
                addResult('store-test-results', `‚úì Store state retrieval works (data length: ${state.windData.length})`, state.windData.length === 1);
                
                unsubscribe();
                addResult('store-test-results', '‚úì Store unsubscription works', true);
                
                output.innerHTML = `Store state: ${JSON.stringify(state, null, 2)}`;
                
            } catch (error) {
                addResult('store-test-results', `‚ùå Store test failed: ${error.message}`, false);
            }
        }
        
        function testGlobals() {
            const results = document.getElementById('global-test-results');
            results.innerHTML = '';
            
            // Test if global functions are available (only if main app is loaded)
            const globals = [
                'navigateToDate',
                'dismissOrientationPopup'
            ];
            
            globals.forEach(globalName => {
                const isAvailable = typeof window[globalName] === 'function';
                addResult('global-test-results', 
                    `${isAvailable ? '‚úì' : '‚ùå'} ${globalName}: ${isAvailable ? 'Available' : 'Not available'}`, 
                    isAvailable
                );
            });
            
            if (typeof window.navigateToDate === 'function') {
                addResult('global-test-results', '‚ÑπÔ∏è You can test navigation with the browser console: navigateToDate("2023-12-25")', true);
            }
        }
    </script>
</body>
</html>