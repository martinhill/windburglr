<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="color-scheme" content="light dark" />
        <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
        {% block title %}{% endblock %}
        {% if dev_mode %}
        <!-- Development mode - use Vite dev server -->
        <script type="module" src="http://localhost:5173/@vite/client"></script>
        <script type="module" src="http://localhost:5173/src/main.js"></script>
        {% else %}
        <!-- Production mode - use built assets -->
        {% for css_file in dist_css_files %}
        <link rel="stylesheet" href="/dist/css/{{ css_file }}">
        {% endfor %}
        {% for js_file in dist_js_files %}
        <script type="module" src="/dist/js/{{ js_file }}"></script>
        {% endfor %}
        {% endif %}
        <script
            src="https://browser.sentry-cdn.com/10.8.0/bundle.tracing.min.js"
            integrity="sha384-TR8N680qOm0pCmrHg2oG0fjpZYcpLanuLrMZck1DTR0NnaJjnqAPuCPI7pMJRmFp"
            crossorigin="anonymous"
        ></script>
        <script>
            Sentry.init({
                dsn: "https://3120a70d778a187a20276c2c8a9cb4f9@o4509923794878464.ingest.us.sentry.io/4509923795140608",
                environment:
                    "{{ 'production' if request.url.hostname != 'localhost' else 'development' }}",
                integrations: [Sentry.browserTracingIntegration()],
                tracesSampleRate: 1.0,
            });
        </script>

        <link rel="icon" href="/static/favicon.ico" sizes="32x32" />
        <link
            rel="apple-touch-icon"
            sizes="180x180"
            href="/static/apple-touch-icon.png"
        />
        <link
            rel="icon"
            type="image/png"
            sizes="32x32"
            href="/static/favicon-32x32.png"
        />
        <link
            rel="icon"
            type="image/png"
            sizes="16x16"
            href="/static/favicon-16x16.png"
        />
        <link
            rel="icon"
            href="/static/favicon.svg"
            type="image/svg+xml"
            sizes="any"
        />
        <link rel="manifest" href="/static/site.webmanifest" />
        {% if gtag_id %}
        <script
            async
            src="https://www.googletagmanager.com/gtag/js?id={{ gtag_id }}"
        ></script>
        <script>
            window.dataLayer = window.dataLayer || [];
            function gtag() {
                dataLayer.push(arguments);
            }
            gtag("js", new Date());
            gtag("config", "{{ gtag_id }}");
        </script>
        {% endif %}
    </head>
    <body>
        <script>
            // Synchronous theme application to prevent flash
            (function() {
                const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
                const theme = prefersDark ? 'dark' : 'light';
                document.documentElement.setAttribute('data-theme', theme);
            })();
        </script>
        <!-- Mobile orientation popup -->
        <div id="orientation-popup" class="orientation-popup hidden">
            <div class="orientation-popup-content">
                <div class="rotate-icon">ðŸ“±â†»</div>
                <h3>Better Experience</h3>
                <p>
                    For the best viewing experience of wind charts, please
                    rotate your device to landscape orientation.
                </p>
                <button class="btn" onclick="dismissOrientationPopup()">
                    Got it!
                </button>
            </div>
        </div>

        <div id="memorial" class="memorial-popup hidden">
            <div class="memorial-popup-content">
                <div class="ghostrider-image">
                    <img alt="Jason 'Ghostrider' Maloney, Toronto Skyline from Leslie Spit"
                         class="memorial-image">
                </div>
                <div class="memorial-controls">
                    <h3>In memory of Jason "Ghostrider" Maloney</h3>
                    <button id="dismiss-memorial" class="btn">
                        RIP Ghostrider
                    </button>
                </div>
            </div>
        </div>

        <div class="container">
            <header>
                <div class="header-content-outer">
                    <div class="header-content">
                        {% block header_content %}{% endblock %}
                    </div>
                    <div
                        class="connection-indicator"
                        id="connection-status"
                        title="Connecting..."
                    ></div>
                </div>
            </header>

            <div class="content-wrapper">
                <div class="charts-container">
                    <div class="chart-section">
                        <!-- <h3>Wind Speed & Direction (Last {{ hours }} hours)</h3> -->
                        <canvas id="windChart"></canvas>
                        <div id="loading-indicator" class="loading-indicator">
                            <img
                                src=""
                                alt="Loading..."
                                class="loading-logo"
                                id="loading-logo-img"
                            />
                        </div>
                    </div>
                </div>

                <div class="controls-container">
                    <div class="controls">
                        {% block controls %}{% endblock %}
                    </div>
                    <div class="meorial-controls">
                        <button id="show-memorial" class="btn">
                            Ghostrider
                        </button>
                    </div>
                </div>
            </div>
        </div>

        {% block extra_scripts %}{% endblock %}
    </body>
</html>
